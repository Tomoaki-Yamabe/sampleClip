# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ¯”è¼ƒå›³

## æ—§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆæ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰

```mermaid
graph TD
    A[é–‹ç™ºå®Œäº†] --> B[8.1: PyTorchâ†’ONNXå¤‰æ›]
    B --> C[8.2: AWS CLIã§S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰]
    C --> D[8.3: Lambda Layerã‚’ä½œæˆ]
    D --> E[8.3: ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆ]
    E --> F[8.4: CDKãƒ‡ãƒ—ãƒ­ã‚¤]
    F --> G[8.5: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰]
    G --> H[8.5: S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰]
    H --> I[8.5: CloudFrontã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–]
    I --> J[å®Œäº†]
    
    style B fill:#ffcccc
    style C fill:#ffcccc
    style D fill:#ffcccc
    style E fill:#ffcccc
    style G fill:#ffcccc
    style H fill:#ffcccc
    style I fill:#ffcccc
```

**å•é¡Œç‚¹:**
- ğŸ”´ æ‰‹å‹•ã‚¹ãƒ†ãƒƒãƒ—ãŒ7ã¤
- ğŸ”´ ONNXå¤‰æ›ãŒå¿…è¦
- ğŸ”´ å„ã‚¹ãƒ†ãƒƒãƒ—ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã‚„ã™ã„
- ğŸ”´ å†ç¾æ€§ãŒä½ã„
- ğŸ”´ 10ã‚·ãƒ¼ãƒ³ã®ã¿ã§ãƒ†ã‚¹ãƒˆ

## æ–°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆè‡ªå‹•åŒ–ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰

```mermaid
graph TD
    A[é–‹ç™ºå®Œäº†] --> B[7.9: ãƒ­ãƒ¼ã‚«ãƒ«æ¤œè¨¼ãƒ•ã‚§ãƒ¼ã‚º]
    B --> B1[7.9.1: nuScenes Miniãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰]
    B1 --> B2[7.9.2: 50-100ã‚·ãƒ¼ãƒ³æŠ½å‡º]
    B2 --> B3[7.9.3: åŸ‹ã‚è¾¼ã¿ç”Ÿæˆ]
    B3 --> B4[7.9.4: Dockerã§çµ±åˆãƒ†ã‚¹ãƒˆ]
    
    B4 --> C[8: CDKçµ±åˆãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ã‚§ãƒ¼ã‚º]
    C --> C1[8.1: Lambda Dockerã‚¤ãƒ¡ãƒ¼ã‚¸æº–å‚™]
    C1 --> C2[8.2: CDK BucketDeploymentè¿½åŠ ]
    C2 --> C3[8.3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰CDKçµ±åˆ]
    C3 --> C4[8.4: deploy.shä½œæˆ]
    
    C4 --> D[8.5: ./deploy.sh å®Ÿè¡Œ]
    D --> D1[è‡ªå‹•: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰]
    D1 --> D2[è‡ªå‹•: Lambda Dockerãƒ“ãƒ«ãƒ‰]
    D2 --> D3[è‡ªå‹•: CDKãƒ‡ãƒ—ãƒ­ã‚¤]
    D3 --> D4[è‡ªå‹•: S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰]
    D4 --> D5[è‡ªå‹•: CloudFrontæ›´æ–°]
    
    D5 --> E[8.6: çµ±åˆãƒ†ã‚¹ãƒˆ]
    E --> F[å®Œäº†]
    
    style B fill:#ccffcc
    style C fill:#ccffcc
    style D fill:#ccffcc
    style D1 fill:#e6ffe6
    style D2 fill:#e6ffe6
    style D3 fill:#e6ffe6
    style D4 fill:#e6ffe6
    style D5 fill:#e6ffe6
```

**æ”¹å–„ç‚¹:**
- âœ… ãƒ­ãƒ¼ã‚«ãƒ«ã§å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
- âœ… ãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ`./deploy.sh`ï¼‰
- âœ… ONNXå¤‰æ›ä¸è¦ï¼ˆPyTorchãã®ã¾ã¾ï¼‰
- âœ… è‡ªå‹•åŒ–ã«ã‚ˆã‚Šå†ç¾æ€§ãŒé«˜ã„
- âœ… 50-100ã‚·ãƒ¼ãƒ³ã§ãƒ†ã‚¹ãƒˆ

## ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰æ¯”è¼ƒ

### æ—§æ–¹å¼ï¼ˆæ‰‹å‹•ï¼‰

```bash
# ã‚¹ãƒ†ãƒƒãƒ—1: ONNXå¤‰æ›
cd data_preparation
python convert_to_onnx.py

# ã‚¹ãƒ†ãƒƒãƒ—2: S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
aws s3 cp models/ s3://bucket/models/ --recursive
aws s3 cp data/ s3://bucket/data/ --recursive
aws s3 cp images/ s3://bucket/images/ --recursive

# ã‚¹ãƒ†ãƒƒãƒ—3: Lambda Layerä½œæˆ
cd lambda
pip install -r requirements.txt -t python/
zip -r layer.zip python/
aws lambda publish-layer-version --layer-name onnx-runtime --zip-file fileb://layer.zip

# ã‚¹ãƒ†ãƒƒãƒ—4: Lambda ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆ
zip -r function.zip lambda_function.py encoders.py vector_db.py

# ã‚¹ãƒ†ãƒƒãƒ—5: CDKãƒ‡ãƒ—ãƒ­ã‚¤
cd infrastructure/cdk
cdk deploy

# ã‚¹ãƒ†ãƒƒãƒ—6: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ“ãƒ«ãƒ‰
cd integ-app/frontend
npm run build
npm run export

# ã‚¹ãƒ†ãƒƒãƒ—7: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
aws s3 sync out/ s3://frontend-bucket/

# ã‚¹ãƒ†ãƒƒãƒ—8: CloudFrontã‚­ãƒ£ãƒƒã‚·ãƒ¥ç„¡åŠ¹åŒ–
aws cloudfront create-invalidation --distribution-id XXXXX --paths "/*"
```

**åˆè¨ˆ: 8ã¤ã®æ‰‹å‹•ã‚³ãƒãƒ³ãƒ‰**

### æ–°æ–¹å¼ï¼ˆè‡ªå‹•åŒ–ï¼‰

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«æ¤œè¨¼ï¼ˆåˆå›ã®ã¿ï¼‰
cd data_preparation
python extract_nuscenes.py --num-scenes 100
python generate_embeddings.py
python generate_umap.py
python create_vector_db.py

cd ../integ-app
docker-compose up  # ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ

# ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆãƒ¯ãƒ³ã‚³ãƒãƒ³ãƒ‰ï¼‰
cd ../infrastructure/cdk
./deploy.sh
```

**åˆè¨ˆ: 1ã¤ã®ã‚³ãƒãƒ³ãƒ‰ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ï¼‰**

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¯”è¼ƒ

### æ—§ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lambda Function (512MB)                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ONNX Runtime (Layer)                â”‚ â”‚
â”‚ â”‚ - text_transformer.onnx (200MB)     â”‚ â”‚
â”‚ â”‚ - text_projector.onnx (10MB)        â”‚ â”‚
â”‚ â”‚ - image_features.onnx (20MB)        â”‚ â”‚
â”‚ â”‚ - image_projector.onnx (10MB)       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Function Code (10MB)                â”‚ â”‚
â”‚ â”‚ - lambda_function.py                â”‚ â”‚
â”‚ â”‚ - encoders.py (ONNXç‰ˆ)              â”‚ â”‚
â”‚ â”‚ - vector_db.py                      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ S3 Bucket                               â”‚
â”‚ - vector_db.json (æ‰‹å‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰)     â”‚
â”‚ - images/ (æ‰‹å‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lambda Docker Image (2GB)               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ PyTorch Models (çµ„ã¿è¾¼ã¿)           â”‚ â”‚
â”‚ â”‚ - text_projector.pt                 â”‚ â”‚
â”‚ â”‚ - image_projector.pt                â”‚ â”‚
â”‚ â”‚ - transformers (è‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰)   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Function Code                       â”‚ â”‚
â”‚ â”‚ - lambda_function.py                â”‚ â”‚
â”‚ â”‚ - encoders.py (PyTorchç‰ˆ)           â”‚ â”‚
â”‚ â”‚ - vector_db.py                      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ S3 Bucket                               â”‚
â”‚ - vector_db.json (CDKè‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰)  â”‚
â”‚ - images/ (CDKè‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰)         â”‚
â”‚ - metadata/ (CDKè‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ‡ãƒ¼ã‚¿è¦æ¨¡ã®æ¯”è¼ƒ

### æ—§: å°è¦æ¨¡ãƒ‡ãƒ¼ã‚¿

```
nuScenes Mini (10ã‚·ãƒ¼ãƒ³)
â”œâ”€â”€ scene-0001.jpg
â”œâ”€â”€ scene-0002.jpg
â”œâ”€â”€ ...
â””â”€â”€ scene-0010.jpg

åˆè¨ˆ: 10ã‚·ãƒ¼ãƒ³
ã‚µã‚¤ã‚º: ~50MB
```

### æ–°: å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿

```
nuScenes Mini (50-100ã‚·ãƒ¼ãƒ³)
â”œâ”€â”€ scene-0001.jpg
â”œâ”€â”€ scene-0002.jpg
â”œâ”€â”€ ...
â””â”€â”€ scene-0100.jpg

åˆè¨ˆ: 50-100ã‚·ãƒ¼ãƒ³
ã‚µã‚¤ã‚º: ~500MB
å¤šæ§˜æ€§: é«˜ï¼ˆå¤©å€™ã€å ´æ‰€ã€äº¤é€šçŠ¶æ³ï¼‰
```

## ã‚³ã‚¹ãƒˆæ¯”è¼ƒ

### æ—§æ–¹å¼
- Lambda: 512MB Ã— å®Ÿè¡Œæ™‚é–“
- S3: æ‰‹å‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ã¿
- é–‹ç™ºæ™‚é–“: é«˜ï¼ˆæ‰‹å‹•ã‚¹ãƒ†ãƒƒãƒ—ãŒå¤šã„ï¼‰

### æ–°æ–¹å¼
- Lambda: 512MB Ã— å®Ÿè¡Œæ™‚é–“ï¼ˆåŒã˜ï¼‰
- S3: BucketDeploymentï¼ˆå·®åˆ†ã®ã¿ï¼‰
- é–‹ç™ºæ™‚é–“: ä½ï¼ˆè‡ªå‹•åŒ–ï¼‰

**æœˆé¡ã‚³ã‚¹ãƒˆ: åŒã˜ï¼ˆ$5-10ï¼‰**
**é–‹ç™ºåŠ¹ç‡: å¤§å¹…æ”¹å–„**

## ã¾ã¨ã‚

| é …ç›® | æ—§æ–¹å¼ | æ–°æ–¹å¼ | æ”¹å–„ |
|------|--------|--------|------|
| ãƒ‡ãƒ¼ã‚¿è¦æ¨¡ | 10ã‚·ãƒ¼ãƒ³ | 50-100ã‚·ãƒ¼ãƒ³ | âœ… 10å€ |
| ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰ | 8ã¤ | 1ã¤ | âœ… 8å€åŠ¹ç‡åŒ– |
| ONNXå¤‰æ› | å¿…è¦ | ä¸è¦ | âœ… ç°¡ç´ åŒ– |
| ãƒ­ãƒ¼ã‚«ãƒ«æ¤œè¨¼ | ãªã— | ã‚ã‚Š | âœ… å“è³ªå‘ä¸Š |
| å†ç¾æ€§ | ä½ | é«˜ | âœ… ä¿¡é ¼æ€§å‘ä¸Š |
| è‡ªå‹•åŒ– | æ‰‹å‹• | è‡ªå‹• | âœ… ã‚¨ãƒ©ãƒ¼å‰Šæ¸› |

æ–°ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ã‚ˆã‚Šã€é–‹ç™ºåŠ¹ç‡ã¨å“è³ªãŒå¤§å¹…ã«å‘ä¸Šã—ã¾ã™ã€‚
